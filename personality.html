<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personality Quizzes | QuizVerse</title>
    <meta name="description" content="Fun interactive personality quizzes to discover your true self!">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        bgLight: '#f8fafc',
                        bgDark: '#1f2937',
                        textDark: '#1f2937',
                        textLight: '#f8fafc',
                        brand: '#2D6A4F',
                        secondary: '#40916C',
                        accent: '#FFB703',
                    }
                }
            }
        }
    </script>
    <style>
        .urdu-text {
            font-family: 'Noto Nastaliq Urdu', serif;
            direction: rtl;
            text-align: right;
        }

        .progress-bar {
            height: 6px;
            transition: width 0.5s ease;
        }

        .quiz-card {
            perspective: 1000px;
        }

        .quiz-card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .quiz-card:hover .quiz-card-inner {
            transform: rotateY(10deg);
        }

        .option-card {
            transition: all 0.3s ease;
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .option-card.selected {
            border-color: #FFB703;
            box-shadow: 0 0 0 3px rgba(255, 183, 3, 0.3);
        }

        .result-card {
            background: linear-gradient(135deg, rgba(45, 106, 79, 0.1) 0%, rgba(64, 145, 108, 0.1) 100%);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #FFB703;
            opacity: 0;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }

        .dark .modal-container {
            background-color: #1f2937;
            color: white;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 640px) {
            .quiz-card-inner {
                transform: none !important;
            }
            
            .quiz-card {
                margin-bottom: 1rem;
            }
            
            #quiz-question {
                font-size: 1.25rem;
            }
            
            .option-card {
                padding: 0.75rem;
            }
            
            .result-card {
                padding: 1rem;
            }
            
            #result-title {
                font-size: 1.5rem;
            }
            
            #result-personality {
                font-size: 1.25rem;
            }
            
            #result-description {
                font-size: 0.9rem;
            }
        }

        /* Add to your existing styles */
.quiz-card {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
}

.quiz-card.visible {
    opacity: 1;
    transform: translateY(0);
}

#load-more-container {
    text-align: center;
    margin-top: 20px;
}

#load-more-btn {
    transition: all 0.3s ease;
}
    </style>
</head>

<body class="font-poppins bg-bgLight text-textDark dark:bg-bgDark dark:text-textLight transition-colors duration-300">
    <!-- Header Section -->
    <header class="sticky top-0 z-50 bg-brand text-white shadow-md">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-brain text-2xl text-accent"></i>
                <a href="index.html" class="text-xl font-bold">QuizVerse</a>
            </div>

            <div class="hidden md:flex space-x-6">
                <a href="index.html" class="hover:text-accent transition">Home</a>
                <a href="quiz-categories.html" class="hover:text-accent transition">Quizzes</a>
                <a href="learning-categories.html" class="hover:text-accent transition">Learning</a>
                <a href="#leaderboard" class="hover:text-accent transition">Leaderboard</a>
            </div>

            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-secondary">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>

                <button id="language-toggle" class="p-2 rounded-full hover:bg-secondary flex items-center">
                    <span class="en-lang">EN</span>
                    <span class="ur-lang hidden">UR</span>
                </button>

                <button id="mobile-menu-button" class="md:hidden p-2 rounded-full hover:bg-secondary">
                    <i class="fas fa-bars"></i>
                </button>

                <button data-action="sign-in" class="hidden md:block bg-accent hover:bg-yellow-500 text-textDark font-medium px-4 py-2 rounded-lg transition">
                    Sign In
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-secondary text-white px-4 py-2">
            <div class="flex flex-col space-y-3">
                <a href="index.html" class="hover:text-accent transition">Home</a>
                <a href="quiz-categories.html" class="hover:text-accent transition">Quizzes</a>
                <a href="learning-categories.html" class="hover:text-accent transition">Learning</a>
                <a href="#leaderboard" class="hover:text-accent transition">Leaderboard</a>
                <button data-action="sign-in" class="w-full bg-accent hover:bg-yellow-500 text-textDark font-medium px-4 py-2 rounded-lg transition">
                    Sign In
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Quiz Selection Section -->
        <section id="quiz-selection" class="mb-8 md:mb-16">
            <div class="text-center mb-8 md:mb-12">
                <h1 class="text-3xl md:text-5xl font-bold mb-4">
                    <span class="en-lang">Discover Your Personality</span>
                    <span class="ur-lang hidden urdu-text">ÿßŸæŸÜ€å ÿ¥ÿÆÿµ€åÿ™ ⁄©Ÿà ÿØÿ±€åÿßŸÅÿ™ ⁄©ÿ±€å⁄∫</span>
                </h1>
                <p class="text-base md:text-lg mb-6 max-w-2xl mx-auto text-gray-600 dark:text-gray-300">
                    <span class="en-lang">Take our fun quizzes to learn more about yourself!</span>
                    <span class="ur-lang hidden urdu-text">ÿßŸæŸÜ€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫ ŸÖÿ≤€åÿØ ÿ¨ÿßŸÜŸÜ€í ⁄©€í ŸÑ€å€í €ÅŸÖÿßÿ±€í ÿ™ŸÅÿ±€åÿ≠€å ⁄©Ÿàÿ¶ÿ≤ ŸÑ€å⁄∫!</span>
                </p>
            </div>

            <div id="quiz-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                <!-- Quiz cards will be loaded here dynamically -->
            </div>
        </section>

        <!-- Quiz Container (hidden by default) -->
        <section id="quiz-container" class="hidden max-w-3xl mx-auto">
              <!-- Add this back button at the top -->
    <div class="mb-4">
        <button id="quiz-back" class="text-brand dark:text-secondary hover:text-secondary dark:hover:text-accent transition flex items-center text-sm md:text-base mb-4">
            <i class="fas fa-arrow-left mr-2"></i>
            <span class="en-lang">Back to quizzes</span>
            <span class="ur-lang hidden urdu-text">⁄©Ÿàÿ¶ÿ≤ÿ≤ Ÿæÿ± ŸàÿßŸæÿ≥ ÿ¨ÿßÿ¶€å⁄∫</span>
        </button>
    </div>
            <div class="mb-4 md:mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span id="quiz-progress" class="text-sm font-medium text-brand dark:text-secondary">
                        <span class="en-lang">Question</span>
                        <span class="ur-lang hidden urdu-text">ÿ≥ŸàÿßŸÑ</span>
                        <span id="current-question-number">1</span>
                        <span class="en-lang">of</span>
                        <span class="ur-lang hidden urdu-text">ÿßÿ≤</span>
                        <span id="total-questions">5</span>
                    </span>
                    <button id="quiz-restart" class="text-sm text-gray-500 dark:text-gray-400 hover:text-brand dark:hover:text-secondary transition">
                        <i class="fas fa-redo mr-1"></i>
                        <span class="en-lang">Restart</span>
                        <span class="ur-lang hidden urdu-text">ÿØŸàÿ®ÿßÿ±€Å ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫</span>
                    </button>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div id="quiz-progress-bar" class="progress-bar bg-brand dark:bg-secondary rounded-full h-2" style="width: 20%"></div>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-8 mb-6 md:mb-8 border border-gray-200 dark:border-gray-700">
                <h2 id="quiz-question" class="text-xl md:text-2xl font-bold mb-4 md:mb-6">
                    <span class="en-lang">Loading question...</span>
                    <span class="ur-lang hidden urdu-text">ÿ≥ŸàÿßŸÑ ŸÑŸà⁄à €ÅŸà ÿ±€Åÿß €Å€í...</span>
                </h2>

                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
                    <!-- Options will be loaded here dynamically -->
                </div>
            </div>

            <div class="flex justify-between">
                <button id="quiz-prev" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium px-4 py-2 rounded-lg transition " disabled>
                    <i class="fas fa-arrow-left mr-2"></i>
                    <span class="en-lang">Previous</span>
                    <span class="ur-lang hidden urdu-text">Ÿæ⁄Ü⁄æŸÑÿß</span>
                </button>
                <button id="quiz-next" class="bg-brand hover:bg-secondary text-white font-medium px-4 py-2 rounded-lg transition " disabled>
                    <span class="en-lang">Next</span>
                    <span class="ur-lang hidden urdu-text">ÿß⁄ØŸÑÿß</span>
                    <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </section>

        <!-- Results Section (hidden by default) -->
        <section id="quiz-results" class="hidden max-w-3xl mx-auto text-center">
            <div class="result-card rounded-xl shadow-lg overflow-hidden border border-brand/20 dark:border-secondary/20 mb-6 md:mb-8">
                <div class="p-6 md:p-10 relative">
                    <!-- Confetti elements will be added here dynamically -->

                    <div class="mb-4 md:mb-6">
                        <div class="w-20 h-20 md:w-24 md:h-24 mx-auto bg-brand/10 dark:bg-brand/20 rounded-full flex items-center justify-center text-3xl md:text-4xl mb-3 md:mb-4 animate-tada">
                            <span id="result-emoji">üèÜ</span>
                        </div>
                        <h2 id="result-title" class="text-2xl md:text-3xl font-bold mb-2">
                            <span class="en-lang">Your Result</span>
                            <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©ÿß ŸÜÿ™€åÿ¨€Å</span>
                        </h2>
                        <p id="result-subtitle" class="text-gray-600 dark:text-gray-300 text-sm md:text-base">
                            <span class="en-lang">Based on your answers</span>
                            <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©€í ÿ¨Ÿàÿßÿ®ÿßÿ™ ⁄©€å ÿ®ŸÜ€åÿßÿØ Ÿæÿ±</span>
                        </p>
                    </div>

                    <h3 id="result-personality" class="text-xl md:text-2xl font-bold text-brand dark:text-secondary mb-3 md:mb-4">
                        Personality Type
                    </h3>
                    <div id="result-image" class="w-full h-40 md:h-48 mb-4 md:mb-6 rounded-lg overflow-hidden">
                        <img src="https://media.giphy.com/media/xT5LMHxhOfscxPfIfm/giphy.gif" alt="Result GIF" class="w-full h-full object-cover">
                    </div>
                    <p id="result-description" class="text-base md:text-lg mb-4 md:mb-6">
                        <span class="en-lang">Your detailed personality description will appear here.</span>
                        <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©€å ÿ¥ÿÆÿµ€åÿ™ ⁄©€å ÿ™ŸÅÿµ€åŸÑ€å Ÿàÿ∂ÿßÿ≠ÿ™ €å€Åÿß⁄∫ ÿ∏ÿß€Åÿ± €ÅŸà⁄Ø€å€î</span>
                    </p>

                    <div id="result-stats" class="grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4 mb-6 md:mb-8">
                        <div class="bg-white/50 dark:bg-gray-700/50 p-2 md:p-3 rounded-lg">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300 mb-1">
                                <span class="en-lang">Accuracy</span>
                                <span class="ur-lang hidden urdu-text">ÿØÿ±ÿ≥ÿ™⁄Ø€å</span>
                            </div>
                            <div class="text-lg md:text-xl font-bold">87%</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-700/50 p-2 md:p-3 rounded-lg">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300 mb-1">
                                <span class="en-lang">Match</span>
                                <span class="ur-lang hidden urdu-text">ŸÖÿ∑ÿßÿ®ŸÇÿ™</span>
                            </div>
                            <div class="text-lg md:text-xl font-bold">9/10</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-700/50 p-2 md:p-3 rounded-lg">
                            <div class="text-xs md:text-sm text-gray-600 dark:text-gray-300 mb-1">
                                <span class="en-lang">Rarity</span>
                                <span class="ur-lang hidden urdu-text">ŸÜÿß€åÿßÿ®€å</span>
                            </div>
                            <div class="text-lg md:text-xl font-bold">15%</div>
                        </div>
                    </div>

                    <div id="result-user-info" class="bg-white/50 dark:bg-gray-700/50 p-3 md:p-4 rounded-lg mb-4 md:mb-6 text-left">
                        <h4 class="font-bold text-base md:text-lg mb-2">
                            <span class="en-lang">Your Profile Info</span>
                            <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©€å Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ ⁄©€å ŸÖÿπŸÑŸàŸÖÿßÿ™</span>
                        </h4>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <span class="text-xs md:text-sm text-gray-500 dark:text-gray-400">
                                    <span class="en-lang">Name:</span>
                                    <span class="ur-lang hidden urdu-text">ŸÜÿßŸÖ:</span>
                                </span>
                                <span id="result-user-name" class="font-medium text-sm md:text-base">Guest</span>
                            </div>
                            <div>
                                <span class="text-xs md:text-sm text-gray-500 dark:text-gray-400">
                                    <span class="en-lang">Level:</span>
                                    <span class="ur-lang hidden urdu-text">ŸÑ€åŸàŸÑ:</span>
                                </span>
                                <span id="result-user-level" class="font-medium text-sm md:text-base">-</span>
                            </div>
                            <div>
                                <span class="text-xs md:text-sm text-gray-500 dark:text-gray-400">
                                    <span class="en-lang">Age:</span>
                                    <span class="ur-lang hidden urdu-text">ÿπŸÖÿ±:</span>
                                </span>
                                <span id="result-user-age" class="font-medium text-sm md:text-base">-</span>
                            </div>
                            <div>
                                <span class="text-xs md:text-sm text-gray-500 dark:text-gray-400">
                                    <span class="en-lang">Country:</span>
                                    <span class="ur-lang hidden urdu-text">ŸÖŸÑ⁄©:</span>
                                </span>
                                <span id="result-user-country" class="font-medium text-sm md:text-base">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-wrap justify-center gap-2 md:gap-3">
                        <button id="result-download" class="bg-brand hover:bg-secondary text-white px-3 py-1 md:px-4 md:py-2 rounded-lg transition flex items-center text-sm md:text-base">
                            <i class="fas fa-download mr-1 md:mr-2"></i>
                            <span class="en-lang">Download</span>
                            <span class="ur-lang hidden urdu-text">⁄àÿßÿ§ŸÜ ŸÑŸà⁄à ⁄©ÿ±€å⁄∫</span>
                        </button>
                        <button id="result-retake" class="bg-accent hover:bg-yellow-500 text-textDark px-3 py-1 md:px-4 md:py-2 rounded-lg transition flex items-center text-sm md:text-base">
                            <i class="fas fa-redo mr-1 md:mr-2"></i>
                            <span class="en-lang">Retake</span>
                            <span class="ur-lang hidden urdu-text">ÿØŸàÿ®ÿßÿ±€Å ŸÑ€å⁄∫</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <a href="personality.html" class="inline-flex items-center text-brand dark:text-secondary font-medium hover:underline text-sm md:text-base">
                    <i class="fas fa-arrow-left mr-2"></i>
                    <span class="en-lang">Back to all quizzes</span>
                    <span class="ur-lang hidden urdu-text">ÿ™ŸÖÿßŸÖ ⁄©Ÿàÿ¶ÿ≤ÿ≤ Ÿæÿ± ŸàÿßŸæÿ≥ ÿ¨ÿßÿ¶€å⁄∫</span>
                </a>
            </div>
        </section>

        <!-- Quiz History Section -->
        <section id="quiz-history" class="mt-8 md:mt-16">
            <div class="flex justify-between items-center mb-4 md:mb-6">
                <h2 class="text-xl md:text-2xl font-bold">
                    <span class="en-lang">Your Quiz History</span>
                    <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©€å ⁄©Ÿàÿ¶ÿ≤ ÿ™ÿßÿ±€åÿÆ</span>
                </h2>
                <button id="clear-history" class="text-xs md:text-sm text-gray-500 dark:text-gray-400 hover:text-brand dark:hover:text-secondary transition">
                    <span class="en-lang">Clear history</span>
                    <span class="ur-lang hidden urdu-text">ÿ™ÿßÿ±€åÿÆ ÿµÿßŸÅ ⁄©ÿ±€å⁄∫</span>
                </button>
            </div>

            <div id="history-container" class="bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="p-4 md:p-6">
                    <div id="history-empty" class="text-center py-6 md:py-8">
                        <i class="fas fa-history text-3xl md:text-4xl text-gray-300 dark:text-gray-600 mb-3 md:mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400 text-sm md:text-base">
                            <span class="en-lang">No quiz history yet. Take a quiz to see your results here!</span>
                            <span class="ur-lang hidden urdu-text">ÿßÿ®⁄æ€å ÿ™⁄© ⁄©Ÿàÿ¶€å ⁄©Ÿàÿ¶ÿ≤ ÿ™ÿßÿ±€åÿÆ ŸÜ€Å€å⁄∫ €Å€í€î ÿßŸæŸÜ€í ŸÜÿ™ÿßÿ¶ÿ¨ €å€Åÿß⁄∫ ÿØ€å⁄©⁄æŸÜ€í ⁄©€í ŸÑ€å€í ÿß€å⁄© ⁄©Ÿàÿ¶ÿ≤ ŸÑ€å⁄∫!</span>
                        </p>
                    </div>
                    <div id="history-items" class="hidden space-y-3 md:space-y-4">
                        <!-- History items will be loaded here dynamically -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white pt-8 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 md:gap-8 mb-6 md:mb-8">
                <div>
                    <div class="flex items-center space-x-2 mb-3 md:mb-4">
                        <i class="fas fa-brain text-2xl text-accent"></i>
                        <span class="text-xl font-bold">QuizVerse</span>
                    </div>
                    <p class="text-gray-400 text-sm md:text-base">The ultimate destination for knowledge seekers and quiz enthusiasts.</p>
                    <div class="flex space-x-3 md:space-x-4 mt-3 md:mt-4">
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-bold mb-3 md:mb-4">Quick Links</h4>
                    <ul class="space-y-1 md:space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-white transition text-sm md:text-base">Home</a></li>
                        <li><a href="quiz-categories.html" class="text-gray-400 hover:text-white transition text-sm md:text-base">Quizzes</a></li>
                        <li><a href="learning-categories.html" class="text-gray-400 hover:text-white transition text-sm md:text-base">Learning</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition text-sm md:text-base">Leaderboard</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-lg font-bold mb-3 md:mb-4">Quiz Types</h4>
                    <ul class="space-y-1 md:space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition text-sm md:text-base">Personality</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition text-sm md:text-base">Knowledge</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition text-sm md:text-base">Trivia</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition text-sm md:text-base">Educational</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-lg font-bold mb-3 md:mb-4">Contact Us</h4>
                    <ul class="space-y-1 md:space-y-2 text-gray-400">
                        <li class="flex items-start">
                            <i class="fas fa-envelope mt-1 mr-2"></i>
                            <span class="text-sm md:text-base">info@quizverse.com</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-phone-alt mt-1 mr-2"></i>
                            <span class="text-sm md:text-base">+92 300 1234567</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mt-1 mr-2"></i>
                            <span class="text-sm md:text-base">Lahore, Pakistan</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-700 pt-4 md:pt-6 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-xs md:text-sm mb-3 md:mb-0">¬© 2025 QuizVerse. All rights reserved.</p>
                <div class="flex space-x-4 md:space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white text-xs md:text-sm transition">Privacy Policy</a>
                    <a href="#" class="text-gray-400 hover:text-white text-xs md:text-sm transition">Terms of Service</a>
                    <a href="#" class="text-gray-400 hover:text-white text-xs md:text-sm transition">Cookies</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="back-to-top" class="fixed bottom-4 right-4 bg-brand text-white w-10 h-10 md:w-12 md:h-12 rounded-full shadow-lg flex items-center justify-center opacity-0 invisible transition-all duration-300">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-brand dark:text-white">
                        <span class="en-lang">Create Your Profile</span>
                        <span class="ur-lang hidden urdu-text">ÿßŸæŸÜÿß Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ ÿ®ŸÜÿßÿ¶€å⁄∫</span>
                    </h3>
                    <button onclick="closeModal('profile-modal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <form id="profile-form" class="space-y-4">
                    <div>
                        <label for="profile-name" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Name</span>
                            <span class="ur-lang hidden urdu-text">ŸÜÿßŸÖ</span>
                        </label>
                        <input type="text" id="profile-name" name="name" required minlength="2"
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                            placeholder="üë§ Your name">
                        <div id="name-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Please enter a valid name (at least 2 characters)</span>
                            <span class="ur-lang hidden urdu-text">ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿß€å⁄© ÿØÿ±ÿ≥ÿ™ ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫ (⁄©ŸÖ ÿßÿ≤ ⁄©ŸÖ 2 ÿ≠ÿ±ŸàŸÅ)</span>
                        </div>
                    </div>

                    <div>
                        <label for="profile-country" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Country</span>
                            <span class="ur-lang hidden urdu-text">ŸÖŸÑ⁄©</span>
                        </label>
                        <select id="profile-country" name="country" required
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand">
                            <option value="">Select your country</option>
                            <option value="AF">Afghanistan</option>
                            <option value="AL">Albania</option>
                            <option value="DZ">Algeria</option>
                            <option value="AR">Argentina</option>
                            <option value="AU">Australia</option>
                            <option value="AT">Austria</option>
                            <option value="BH">Bahrain</option>
                            <option value="BD">Bangladesh</option>
                            <option value="BR">Brazil</option>
                            <option value="CA">Canada</option>
                            <option value="CN">China</option>
                            <option value="EG">Egypt</option>
                            <option value="FR">France</option>
                            <option value="DE">Germany</option>
                            <option value="IN">India</option>
                            <option value="ID">Indonesia</option>
                            <option value="IR">Iran</option>
                            <option value="IQ">Iraq</option>
                            <option value="IT">Italy</option>
                            <option value="JP">Japan</option>
                            <option value="JO">Jordan</option>
                            <option value="KW">Kuwait</option>
                            <option value="LB">Lebanon</option>
                            <option value="MY">Malaysia</option>
                            <option value="MX">Mexico</option>
                            <option value="MA">Morocco</option>
                            <option value="NP">Nepal</option>
                            <option value="PK">Pakistan</option>
                            <option value="PS">Palestine</option>
                            <option value="PH">Philippines</option>
                            <option value="QA">Qatar</option>
                            <option value="RU">Russia</option>
                            <option value="SA">Saudi Arabia</option>
                            <option value="SG">Singapore</option>
                            <option value="ZA">South Africa</option>
                            <option value="KR">South Korea</option>
                            <option value="ES">Spain</option>
                            <option value="LK">Sri Lanka</option>
                            <option value="SE">Sweden</option>
                            <option value="CH">Switzerland</option>
                            <option value="SY">Syria</option>
                            <option value="TH">Thailand</option>
                            <option value="TR">Turkey</option>
                            <option value="AE">United Arab Emirates</option>
                            <option value="GB">United Kingdom</option>
                            <option value="US">United States</option>
                            <option value="VN">Vietnam</option>
                            <option value="YE">Yemen</option>
                            <option value="ZW">Zimbabwe</option>
                        </select>
                        <div id="country-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Please select your country</span>
                            <span class="ur-lang hidden urdu-text">ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßŸæŸÜÿß ŸÖŸÑ⁄© ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</span>
                        </div>
                    </div>

                    <div>
                        <label for="profile-age" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Age</span>
                            <span class="ur-lang hidden urdu-text">ÿπŸÖÿ±</span>
                        </label>
                        <input type="number" id="profile-age" name="age" required min="5" max="99"
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                            placeholder="Your age">
                        <div id="age-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Please enter a valid age (5-99)</span>
                            <span class="ur-lang hidden urdu-text">ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿß€å⁄© ÿØÿ±ÿ≥ÿ™ ÿπŸÖÿ± ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫ (5-99)</span>
                        </div>
                    </div>

                    <div>
                        <label for="profile-level" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Level</span>
                            <span class="ur-lang hidden urdu-text">ŸÑ€åŸàŸÑ</span>
                        </label>
                        <select id="profile-level" name="level" required
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand">
                            <option value="">Select your level</option>
                            <option value="student">Student</option>
                            <option value="kid">Kid</option>
                            <option value="adult">Adult</option>
                            <option value="teacher">Teacher</option>
                            <option value="pro">Pro Learner</option>
                            <option value="parent">Parent</option>
                            <option value="senior">Senior</option>
                        </select>
                        <div id="level-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Please select your level</span>
                            <span class="ur-lang hidden urdu-text">ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßŸæŸÜÿß ŸÑ€åŸàŸÑ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</span>
                        </div>
                    </div>

                    <div>
                        <label for="profile-gender" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Gender</span>
                            <span class="ur-lang hidden urdu-text">ÿ¨ŸÜÿ≥</span>
                        </label>
                        <select id="profile-gender" name="gender" required
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand">
                            <option value="">Select your gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not">Prefer not to say</option>
                        </select>
                        <div id="gender-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Please select your gender</span>
                            <span class="ur-lang hidden urdu-text">ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿßŸæŸÜ€å ÿ¨ŸÜÿ≥ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</span>
                        </div>
                    </div>

                    <div>
                        <label for="profile-email" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Email (optional)</span>
                            <span class="ur-lang hidden urdu-text">ÿß€å ŸÖ€åŸÑ (ÿßÿÆÿ™€åÿßÿ±€å)</span>
                        </label>
                        <input type="email" id="profile-email" name="email"
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                            placeholder="üìß your@email.com">
                    </div>

                    <div>
                        <label for="profile-password" class="block mb-2 mt-2 font-medium">
                            <span class="en-lang">Create Password</span>
                            <span class="ur-lang hidden urdu-text">Ÿæÿßÿ≥ Ÿàÿ±⁄à ÿ®ŸÜÿßÿ¶€å⁄∫</span>
                        </label>
                        <input type="password" id="profile-password" name="password" minlength="6"
                            class="w-full bg-bgLight dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                            placeholder="At least 6 characters" required>
                        <div id="password-error" class="text-red-500 text-sm mt-1 hidden">
                            <span class="en-lang">Password must be at least 6 characters</span>
                            <span class="ur-lang hidden urdu-text">Ÿæÿßÿ≥ Ÿàÿ±⁄à ⁄©ŸÖ ÿßÿ≤ ⁄©ŸÖ 6 ÿ≠ÿ±ŸàŸÅ ⁄©ÿß €ÅŸàŸÜÿß ⁄Üÿß€Å€å€í</span>
                        </div>
                    </div>

                    <div id="profile-success" class="hidden p-3 mt-2 bg-green-500/20 rounded-lg text-green-700 dark:text-green-300 mb-4">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span class="en-lang">Profile saved successfully!</span>
                        <span class="ur-lang hidden urdu-text">Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ŸÖÿ≠ŸÅŸàÿ∏ €ÅŸà ⁄Ø€åÿß!</span>
                    </div>

                    <div id="profile-error" class="hidden mt-2 p-3 bg-red-500/20 rounded-lg text-red-700 dark:text-red-300 mb-4">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span class="en-lang">There was an error saving your profile. Please try again.</span>
                        <span class="ur-lang hidden urdu-text">ÿ¢Ÿæ ⁄©ÿß Ÿæÿ±ŸàŸÅÿßÿ¶ŸÑ ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±ŸÜ€í ŸÖ€å⁄∫ ÿÆÿ±ÿßÿ®€å €ÅŸàÿ¶€å€î ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿØŸàÿ®ÿßÿ±€Å ⁄©Ÿàÿ¥ÿ¥ ⁄©ÿ±€å⁄∫€î</span>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-between mt-4 gap-3">
                        <button type="button" onclick="skipProfile()" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            <span class="en-lang">Skip for Now</span>
                            <span class="ur-lang hidden urdu-text">ÿßÿ®⁄æ€å ⁄©€í ŸÑ€å€í ⁄Ü⁄æŸà⁄ë ÿØ€å⁄∫</span>
                        </button>
                        <button type="submit" class="bg-brand hover:bg-secondary text-white px-4 py-2 rounded-lg transition flex-1">
                            <span class="en-lang">Save and Continue</span>
                            <span class="ur-lang hidden urdu-text">ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿ¨ÿßÿ±€å ÿ±⁄©⁄æ€å⁄∫</span>
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
    // Current quiz state
    let quizData = {};
    let currentQuiz = null;
    let currentQuestion = 0;
    let answers = [];
    let points = {};
    let currentLanguage = localStorage.getItem('language') || 'en';
    let visibleCards = 6; // Initial number of cards to show
let allCardsLoaded = false;

    // DOM elements
    const quizSelection = document.getElementById('quiz-selection');
    const quizContainer = document.getElementById('quiz-container');
    const quizResults = document.getElementById('quiz-results');
    const quizProgress = document.getElementById('quiz-progress');
    const quizProgressBar = document.getElementById('quiz-progress-bar');
    const quizQuestion = document.getElementById('quiz-question');
    const quizOptions = document.getElementById('quiz-options');
    const quizPrev = document.getElementById('quiz-prev');
    const quizNext = document.getElementById('quiz-next');
    const quizRestart = document.getElementById('quiz-restart');
    const resultTitle = document.getElementById('result-title');
    const resultSubtitle = document.getElementById('result-subtitle');
    const resultPersonality = document.getElementById('result-personality');
    const resultDescription = document.getElementById('result-description');
    const resultEmoji = document.getElementById('result-emoji');
    const resultImage = document.getElementById('result-image');
    const resultDownload = document.getElementById('result-download');
    const resultRetake = document.getElementById('result-retake');
    const historyContainer = document.getElementById('history-container');
    const historyEmpty = document.getElementById('history-empty');
    const historyItems = document.getElementById('history-items');
    const clearHistory = document.getElementById('clear-history');
    const themeToggle = document.getElementById('theme-toggle');
    const languageToggle = document.getElementById('language-toggle');
    const enLangElements = document.querySelectorAll('.en-lang');
    const urLangElements = document.querySelectorAll('.ur-lang');
    const backToTop = document.getElementById('back-to-top');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const quizCardsContainer = document.getElementById('quiz-cards-container');
    const currentQuestionNumber = document.getElementById('current-question-number');
    const totalQuestions = document.getElementById('total-questions');
    const resultUserName = document.getElementById('result-user-name');
    const resultUserLevel = document.getElementById('result-user-level');
    const resultUserAge = document.getElementById('result-user-age');
    const resultUserCountry = document.getElementById('result-user-country');
    const profileModal = document.getElementById('profile-modal');
    const profileForm = document.getElementById('profile-form');

    // Initialize the page
    document.addEventListener('DOMContentLoaded', async function () {
        // Load quiz data from JSON file
        try {
            const response = await fetch('data/personality-quiz-data.json');
            if (!response.ok) {
                throw new Error('Failed to fetch quiz data');
            }
            quizData = await response.json();
            
            // Load quiz cards
            loadQuizCards();
            loadQuizHistory();
            setupEventListeners();
            
            // Set initial language
            toggleLanguage(false);
            
            // Check for saved theme preference
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
            
            // Check for profile and update UI
            updateHeaderButton();
        } catch (error) {
            console.error('Error loading quiz data:', error);
            showErrorToast('Failed to load quiz data. Please try again later.');
            // Load sample data if available
            quizData = {
                "pakistani-city": {
                    "id": "pakistani-city",
                    "title": "Which Pakistani City Matches Your Personality?",
                    "title_ur": "⁄©ŸàŸÜ ÿ≥ÿß Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ€å ÿ¥€Åÿ± ÿ¢Ÿæ ⁄©€å ÿ¥ÿÆÿµ€åÿ™ ÿ≥€í ŸÖ€åŸÑ ⁄©⁄æÿßÿ™ÿß €Å€íÿü",
                    "description": "Discover which Pakistani city best matches your personality traits and lifestyle.",
                    "description_ur": "ÿØÿ±€åÿßŸÅÿ™ ⁄©ÿ±€å⁄∫ ⁄©€Å ⁄©ŸàŸÜ ÿ≥ÿß Ÿæÿß⁄©ÿ≥ÿ™ÿßŸÜ€å ÿ¥€Åÿ± ÿ¢Ÿæ ⁄©€å ÿ¥ÿÆÿµ€åÿ™ ÿßŸàÿ± ÿ∑ÿ±ÿ≤ ÿ≤ŸÜÿØ⁄Ø€å ÿ≥€í ÿ≥ÿ® ÿ≥€í ÿ≤€åÿßÿØ€Å ŸÖ€åŸÑ ⁄©⁄æÿßÿ™ÿß €Å€í€î",
                    "image": "https://images.unsplash.com/photo-1517842645767-c639042777db?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    "time": 2,
                    "isNew": true,
                    "questions": [],
                    "results": {}
                }
            };
            loadQuizCards();
        }
    });

    // Set up event listeners
    function setupEventListeners() {
        quizPrev.addEventListener('click', prevQuestion);
        quizNext.addEventListener('click', nextQuestion);
        quizRestart.addEventListener('click', restartQuiz);
        resultDownload.addEventListener('click', showDownloadModal);
        resultRetake.addEventListener('click', restartQuiz);
        clearHistory.addEventListener('click', clearQuizHistory);
        themeToggle.addEventListener('click', toggleTheme);
        languageToggle.addEventListener('click', toggleLanguage);
        mobileMenuButton.addEventListener('click', toggleMobileMenu);
        
            document.getElementById('quiz-back').addEventListener('click', backToQuizzes);

            function backToQuizzes() {
    quizContainer.classList.add('hidden');
    quizResults.classList.add('hidden');
    quizSelection.classList.remove('hidden');
}

document.addEventListener('click', function(e) {
    if (!mobileMenu.contains(e.target) && e.target !== mobileMenuButton) {
        mobileMenu.classList.add('hidden');
    }
});
        
        // Back to top button
        window.addEventListener('scroll', toggleBackToTop);
        backToTop.addEventListener('click', scrollToTop);
        
        // Sign in/profile buttons
        document.querySelectorAll('[data-action="sign-in"]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                if (localStorage.getItem('quizverse_profile')) {
                    openProfileView();
                } else {
                    openModal('profile-modal');
                }
            });
        });

        // Profile form submission
        profileForm.addEventListener('submit', saveProfile);
    }

    // Load quiz cards dynamically
    function loadQuizCards() {
    quizCardsContainer.innerHTML = '';
    const quizIds = Object.keys(quizData);
    allCardsLoaded = visibleCards >= quizIds.length;
    
    // Show only the first 'visibleCards' quizzes
    quizIds.slice(0, visibleCards).forEach((quizId, index) => {
        const quiz = quizData[quizId];
        const quizCard = createQuizCard(quizId, quiz);
        quizCardsContainer.appendChild(quizCard);
        
        // Add animation with staggered delay
        setTimeout(() => {
            quizCard.classList.add('visible');
        }, index * 100);
    });
    
    // Update or create the load more button
    updateLoadMoreButton(quizIds.length);
}

function createQuizCard(quizId, quiz) {
    const quizCard = document.createElement('div');
    quizCard.className = 'quiz-card';
    
    const title = currentLanguage === 'ur' ? quiz.title_ur || quiz.title : quiz.title;
    const description = currentLanguage === 'ur' ? quiz.description_ur || quiz.description : quiz.description;
    const questionsText = currentLanguage === 'ur' ? `${quiz.questions.length} ÿ≥ŸàÿßŸÑÿßÿ™` : `${quiz.questions.length} questions`;
    const timeText = currentLanguage === 'ur' ? `${quiz.time} ŸÖŸÜŸπ` : `${quiz.time} min`;
    const startText = currentLanguage === 'ur' ? '⁄©Ÿàÿ¶ÿ≤ ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫' : 'Start Quiz';
    
    quizCard.innerHTML = `
        <div class="quiz-card-inner bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden h-full flex flex-col border border-gray-200 dark:border-gray-700">
            <div class="h-40 md:h-48 bg-gradient-to-r from-brand to-secondary relative overflow-hidden">
                <img src="${quiz.image}" alt="${quiz.title}" class="w-full h-full object-cover opacity-90 transition-opacity duration-300 group-hover:opacity-100" loading="lazy">
                <div class="absolute inset-0 bg-gradient-to-t from-black/30 to-transparent"></div>
                ${quiz.isNew ? `<div class="absolute top-3 right-3 bg-accent text-textDark px-2 py-1 rounded-full text-xs md:text-sm font-bold">NEW</div>` : ''}
                ${quiz.isPopular ? `<div class="absolute top-3 right-3 bg-accent text-textDark px-2 py-1 rounded-full text-xs md:text-sm font-bold">POPULAR</div>` : ''}
            </div>
            <div class="p-4 md:p-6 flex-grow">
                <h3 class="text-lg md:text-xl font-bold mb-2 md:mb-3">${title}</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm md:text-base mb-3 md:mb-4">${description}</p>
                <div class="flex items-center text-xs md:text-sm text-gray-500 dark:text-gray-400">
                    <i class="fas fa-question-circle mr-2"></i>
                    <span>${questionsText}</span>
                    <i class="fas fa-clock ml-3 md:ml-4 mr-2"></i>
                    <span>${timeText}</span>
                </div>
            </div>
            <div class="px-4 md:px-6 pb-4 md:pb-6">
                <button onclick="startQuiz('${quizId}')" class="w-full bg-brand hover:bg-secondary text-white font-medium py-1 md:py-2 px-3 md:px-4 rounded-lg transition text-sm md:text-base">
                    ${startText}
                </button>
            </div>
        </div>
    `;
    return quizCard;
}

function updateLoadMoreButton(totalCards) {
    let loadMoreContainer = document.getElementById('load-more-container');
    if (!loadMoreContainer) {
        loadMoreContainer = document.createElement('div');
        loadMoreContainer.id = 'load-more-container';
        quizSelection.appendChild(loadMoreContainer);
    }
    
    if (allCardsLoaded) {
        if (visibleCards > 6) { // Only show "Show Less" if we've loaded more than initial
            loadMoreContainer.innerHTML = `
                <button id="load-more-btn" onclick="showLessCards()" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium px-6 py-2 rounded-lg transition">
                    ${currentLanguage === 'ur' ? '⁄©ŸÖ ÿØ⁄©⁄æÿßÿ¶€å⁄∫' : 'Show Less'}
                </button>
            `;
        } else {
            loadMoreContainer.innerHTML = ''; // Hide button if no cards to show/hide
        }
    } else {
        loadMoreContainer.innerHTML = `
            <button id="load-more-btn" onclick="loadMoreCards()" class="bg-brand hover:bg-secondary text-white font-medium px-6 py-2 rounded-lg transition">
                ${currentLanguage === 'ur' ? 'ŸÖÿ≤€åÿØ ÿØ⁄©⁄æÿßÿ¶€å⁄∫' : 'Show More'}
            </button>
        `;
    }
}

function loadMoreCards() {
    visibleCards += 3;
    loadQuizCards();
}

function showLessCards() {
    visibleCards = 6;
    loadQuizCards();
}   

// Start a quiz
    function startQuiz(quizId) {
        currentQuiz = quizData[quizId];
        currentQuestion = 0;
        answers = [];
        points = {};

        // Initialize points for all possible results
        Object.keys(currentQuiz.results).forEach(result => {
            points[result] = 0;
        });

        // Hide quiz selection and show quiz container
        quizSelection.classList.add('hidden');
        quizContainer.classList.remove('hidden');
        quizResults.classList.add('hidden');

        // Set total questions
        totalQuestions.textContent = currentQuiz.questions.length;

        // Load the first question
        loadQuestion();
    }

    // Load the current question
    function loadQuestion() {
        const question = currentQuiz.questions[currentQuestion];

        // Update progress
    currentQuestionNumber.textContent = currentQuestion + 1;
    quizProgressBar.style.width = `${((currentQuestion) / currentQuiz.questions.length) * 100}%`;
        // Set question text based on current language
        if (currentLanguage === 'ur') {
            quizQuestion.innerHTML = `<span class="urdu-text">${question.question_ur || question.question}</span>`;
        } else {
            quizQuestion.innerHTML = question.question;
        }

        // Clear previous options
        quizOptions.innerHTML = '';

        // Add new options
        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = `option-card bg-bgLight dark:bg-gray-700 p-3 md:p-4 rounded-lg border border-gray-200 dark:border-gray-600 cursor-pointer ${answers[currentQuestion] === index ? 'selected' : ''}`;
            
            if (currentLanguage === 'ur') {
                optionElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 md:w-10 md:h-10 bg-brand/10 dark:bg-brand/20 rounded-full flex items-center justify-center mr-2 md:mr-3 text-brand dark:text-secondary">
                            <span class="text-lg md:text-xl">${option.emoji}</span>
                        </div>
                        <div class="urdu-text">
                            <h3 class="font-medium">${option.text_ur || option.text}</h3>
                            <p class="text-xs md:text-sm text-gray-500 dark:text-gray-400 mt-1">${getOptionDescriptionUr(option)}</p>
                        </div>
                    </div>
                `;
            } else {
                optionElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-8 h-8 md:w-10 md:h-10 bg-brand/10 dark:bg-brand/20 rounded-full flex items-center justify-center mr-2 md:mr-3 text-brand dark:text-secondary">
                            <span class="text-lg md:text-xl">${option.emoji}</span>
                        </div>
                        <div>
                            <h3 class="font-medium">${option.text}</h3>
                            <p class="text-xs md:text-sm text-gray-500 dark:text-gray-400 mt-1">${getOptionDescription(option)}</p>
                        </div>
                    </div>
                `;
            }

            optionElement.addEventListener('click', () => selectOption(index));
            quizOptions.appendChild(optionElement);
        });

        // Update button states
        quizPrev.disabled = currentQuestion === 0;
        quizNext.disabled = answers[currentQuestion] === undefined;
        
        // Update next button text
        if (currentQuestion === currentQuiz.questions.length - 1) {
            if (currentLanguage === 'ur') {
                quizNext.innerHTML = `<span class="urdu-text">ŸÜÿ™ÿßÿ¶ÿ¨ ÿØ€å⁄©⁄æ€å⁄∫</span><i class="fas fa-arrow-right ml-2"></i>`;
            } else {
                quizNext.innerHTML = `<span>See Results</span><i class="fas fa-arrow-right ml-2"></i>`;
            }
        } else {
            if (currentLanguage === 'ur') {
                quizNext.innerHTML = `<span class="urdu-text">ÿß⁄ØŸÑÿß</span><i class="fas fa-arrow-right ml-2"></i>`;
            } else {
                quizNext.innerHTML = `<span>Next</span><i class="fas fa-arrow-right ml-2"></i>`;
            }
        }
    }

    // Get a fun description for the option based on emoji (English)
    function getOptionDescription(option) {
        const emojiDescriptions = {
            "üèõÔ∏è": "For culture vultures and history buffs",
            "üè†": "Homebodies and family-oriented folks",
            "üçΩÔ∏è": "Foodies and culinary explorers",
            "‚õ∞Ô∏è": "Nature lovers and adventure seekers",
            "üèñÔ∏è": "Beach bums and sun worshippers",
            "üèîÔ∏è": "Mountain enthusiasts and fresh air fans",
            "üé®": "Art lovers and creative souls",
            "üçú": "Flavor chasers and culinary adventurers",
            "‚ùÑÔ∏è": "Cold weather creatures and cozy lovers",
            "üå∏": "Spring chickens and flower admirers",
            "‚òÄÔ∏è": "Sunshine seekers and summer lovers",
            "üçÇ": "Autumn admirers and leaf peepers",
            "‚ö°": "Fast movers and energetic doers",
            "üìä": "Organized planners and detail-oriented",
            "üé≠": "Creative thinkers and outside-the-box",
            "‚è≥": "Traditionalists and steady workers",
            "üíº": "Career-driven and ambitious types",
            "üõ°Ô∏è": "Safety-first and clean freaks",
            "ü§ù": "Community-focused and traditional"
        };
        return emojiDescriptions[option.emoji] || "Select this option if it resonates with you";
    }

    // Get a fun description for the option based on emoji (Urdu)
    function getOptionDescriptionUr(option) {
        const emojiDescriptions = {
            "üèõÔ∏è": "ÿ´ŸÇÿßŸÅÿ™ ÿßŸàÿ± ÿ™ÿßÿ±€åÿÆ ⁄©€í ÿ¥ŸàŸÇ€åŸÜ ⁄©€í ŸÑ€å€í",
            "üè†": "⁄Ø⁄æÿ± Ÿæÿ± ÿ±€ÅŸÜ€í ŸàÿßŸÑ€í ÿßŸàÿ± ÿÆÿßŸÜÿØÿßŸÜ€å ŸÑŸà⁄ØŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üçΩÔ∏è": "⁄©⁄æÿßŸÜ€í ⁄©€í ÿ¥ŸàŸÇ€åŸÜ ÿßŸàÿ± ⁄©⁄æÿßŸÜÿß ÿØÿ±€åÿßŸÅÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "‚õ∞Ô∏è": "ŸÅÿ∑ÿ±ÿ™ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ŸÖ€ÅŸÖ ÿ¨Ÿàÿ§⁄∫ ⁄©€í ŸÑ€å€í",
            "üèñÔ∏è": "ÿ≥ÿßÿ≠ŸÑ Ÿæÿ± ŸàŸÇÿ™ ⁄Øÿ≤ÿßÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ÿØ⁄æŸàŸæ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üèîÔ∏è": "Ÿæ€Åÿß⁄ëŸà⁄∫ ⁄©€í ÿ¥ŸàŸÇ€åŸÜ ÿßŸàÿ± ÿ™ÿßÿ≤€Å €ÅŸàÿß Ÿæÿ≥ŸÜÿØ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üé®": "ŸÅŸÜ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ÿ™ÿÆŸÑ€åŸÇ€å ŸÑŸà⁄ØŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üçú": "ÿ∞ÿßÿ¶ŸÇŸà⁄∫ ⁄©€í Ÿæ€å⁄Ü⁄æ€í ÿ®⁄æÿß⁄ØŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ⁄©⁄æÿßŸÜ€í ⁄©€í ŸÖ€ÅŸÖ ÿ¨Ÿàÿ§⁄∫ ⁄©€í ŸÑ€å€í",
            "‚ùÑÔ∏è": "ÿ≥ÿ±ÿØ ŸÖŸàÿ≥ŸÖ ÿßŸàÿ± ÿ¢ÿ±ÿßŸÖ ÿØ€Å ÿ¨⁄Ø€ÅŸà⁄∫ ⁄©Ÿà ÿ™ÿ±ÿ¨€åÿ≠ ÿØ€åŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üå∏": "ÿ®€Åÿßÿ± ÿßŸàÿ± Ÿæ⁄æŸàŸÑŸà⁄∫ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "‚òÄÔ∏è": "ÿØ⁄æŸàŸæ ÿßŸàÿ± ⁄Øÿ±ŸÖ€åŸà⁄∫ ÿ≥€í ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üçÇ": "ÿÆÿ≤ÿß⁄∫ ÿßŸàÿ± Ÿæÿ™Ÿà⁄∫ ⁄©€å ÿ±ŸÜ⁄Øÿ™ ÿ≥€í ŸÑÿ∑ŸÅ ÿßŸÜÿØŸàÿ≤ €ÅŸàŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "‚ö°": "ÿ™€åÿ≤ ÿ±ŸÅÿ™ÿßÿ± ÿßŸàÿ± ÿ™ŸàÿßŸÜÿßÿ¶€å ÿ≥€í ÿ®⁄æÿ±ŸæŸàÿ± ŸÑŸà⁄ØŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üìä": "ŸÖŸÜÿ∏ŸÖ ÿßŸàÿ± ÿ™ŸÅÿµ€åŸÑÿßÿ™ Ÿæÿ± ÿ™Ÿàÿ¨€Å ÿØ€åŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üé≠": "ÿ™ÿÆŸÑ€åŸÇ€å ÿ≥Ÿà⁄Ü ÿ±⁄©⁄æŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ÿ±Ÿàÿß€åÿ™€å ÿ≥Ÿà⁄Ü ÿ≥€í €ÅŸπ ⁄©ÿ± ÿ≥Ÿà⁄ÜŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "‚è≥": "ÿ±Ÿàÿß€åÿ™€å ÿßŸàÿ± ŸÖÿ≥ÿ™ŸÇŸÑ ŸÖÿ≤ÿßÿ¨ ⁄©ÿßŸÖ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üíº": "⁄©€åÿ±€åÿ¶ÿ± Ÿæÿ± ÿ™Ÿàÿ¨€Å ÿØ€åŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ÿ®ŸÑŸÜÿØ ÿ≠ŸàÿµŸÑ€Å ÿ±⁄©⁄æŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "üõ°Ô∏è": "ÿ≠ŸÅÿßÿ∏ÿ™ ⁄©Ÿà ÿ™ÿ±ÿ¨€åÿ≠ ÿØ€åŸÜ€í ŸàÿßŸÑŸà⁄∫ ÿßŸàÿ± ÿµŸÅÿßÿ¶€å Ÿæÿ≥ŸÜÿØŸà⁄∫ ⁄©€í ŸÑ€å€í",
            "ü§ù": "ŸÖÿπÿßÿ¥ÿ±ÿ™€å ÿßŸàÿ± ÿ±Ÿàÿß€åÿ™€å ŸÑŸà⁄ØŸà⁄∫ ⁄©€í ŸÑ€å€í"
        };
        return emojiDescriptions[option.emoji] || "ÿß⁄Øÿ± €å€Å ÿ¢Ÿæ ÿ≥€í ŸÖ€åŸÑ ⁄©⁄æÿßÿ™ÿß €Å€í ÿ™Ÿà ÿßÿ≥ ÿ¢Ÿæÿ¥ŸÜ ⁄©Ÿà ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫";
    }

    // Select an option for the current question
    function selectOption(optionIndex) {
        // Remove selected class from all options
        document.querySelectorAll('.option-card').forEach(card => {
            card.classList.remove('selected');
        });

        // Add selected class to clicked option
        document.querySelectorAll('.option-card')[optionIndex].classList.add('selected');

        // Save the answer
        answers[currentQuestion] = optionIndex;

        // Enable next button
        quizNext.disabled = false;
    }

    // Go to the next question
    function nextQuestion() {
        // Add points for the selected answer
        if (answers[currentQuestion] !== undefined) {
            const selectedOption = currentQuiz.questions[currentQuestion].options[answers[currentQuestion]];
            Object.keys(selectedOption.points).forEach(result => {
                points[result] += selectedOption.points[result];
            });
        }

        // If this was the last question, show results
        if (currentQuestion === currentQuiz.questions.length - 1) {
            showResults();
            return;
        }

        // Otherwise go to next question
        currentQuestion++;
        loadQuestion();
    }

    // Go to the previous question
    function prevQuestion() {
        if (currentQuestion > 0) {
            // Remove points from the previous answer
            if (answers[currentQuestion] !== undefined) {
                const selectedOption = currentQuiz.questions[currentQuestion].options[answers[currentQuestion]];
                Object.keys(selectedOption.points).forEach(result => {
                    points[result] -= selectedOption.points[result];
                });
            }

            currentQuestion--;
            loadQuestion();
        }
    }

    // Show quiz results
    function showResults() {
        // Calculate the result with highest points
        let maxPoints = 0;
        let resultKey = null;

        Object.keys(points).forEach(key => {
            if (points[key] > maxPoints) {
                maxPoints = points[key];
                resultKey = key;
            }
        });

        const result = currentQuiz.results[resultKey];

        // Update result elements based on current language
        if (currentLanguage === 'ur') {
            resultTitle.innerHTML = `<span class="urdu-text">${result.title_ur || result.title}</span>`;
            resultSubtitle.innerHTML = `<span class="urdu-text">ÿ¢Ÿæ ⁄©€í ÿ¨Ÿàÿßÿ®ÿßÿ™ ⁄©€å ÿ®ŸÜ€åÿßÿØ Ÿæÿ±</span>`;
            resultPersonality.innerHTML = `<span class="urdu-text">${resultKey}</span>`;
            resultDescription.innerHTML = `<span class="urdu-text">${result.description_ur || result.description}</span>`;
        } else {
            resultTitle.textContent = result.title;
            resultSubtitle.textContent = "Based on your answers";
            resultPersonality.textContent = resultKey;
            resultDescription.textContent = result.description;
        }
        
        resultEmoji.textContent = result.emoji;
        resultImage.innerHTML = `<img src="${result.image}" alt="${resultKey}" class="w-full h-full object-cover">`;

        // Update stats
        document.querySelector('#result-stats div:nth-child(1) div:nth-child(2)').textContent = result.accuracy;
        document.querySelector('#result-stats div:nth-child(2) div:nth-child(2)').textContent = result.match;
        document.querySelector('#result-stats div:nth-child(3) div:nth-child(2)').textContent = result.rarity;

        // Update user info in results
        updateUserInfoInResults();

        // Hide quiz container and show results
        quizContainer.classList.add('hidden');
        quizResults.classList.remove('hidden');

        // Create confetti effect
        createConfetti();

        // Save to quiz history
        saveQuizResult(currentQuiz.title, resultKey);
    }

    // Update user info in results section
    function updateUserInfoInResults() {
        const profile = JSON.parse(localStorage.getItem('quizverse_profile'));
        if (profile) {
            resultUserName.textContent = profile.name || 'Guest';
            resultUserLevel.textContent = profile.level ? profile.level.charAt(0).toUpperCase() + profile.level.slice(1) : '-';
            resultUserAge.textContent = profile.age || '-';
            resultUserCountry.textContent = getCountryName(profile.country) || '-';
        } else {
            resultUserName.textContent = 'Guest';
            resultUserLevel.textContent = '-';
            resultUserAge.textContent = '-';
            resultUserCountry.textContent = '-';
        }
    }

    // Get country name from code
    function getCountryName(code) {
        const countries = {
            'PK': 'Pakistan',
            'US': 'United States',
            'GB': 'United Kingdom',
            'CA': 'Canada',
            'AU': 'Australia',
            'IN': 'India',
            'AE': 'UAE',
            'SA': 'Saudi Arabia',
        };
        return countries[code] || code;
    }

    // Create confetti animation
    function createConfetti() {
        const colors = ['#FFB703', '#2D6A4F', '#40916C', '#3A0CA3', '#7209B7'];
        const container = document.querySelector('#quiz-results .result-card');

        // Clear any existing confetti
        document.querySelectorAll('.confetti').forEach(el => el.remove());

        // Create new confetti elements
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.top = '-10px';
            confetti.style.width = `${Math.random() * 10 + 5}px`;
            confetti.style.height = `${Math.random() * 10 + 5}px`;
            confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            container.appendChild(confetti);
        }
    }

    // Restart the quiz
    function restartQuiz() {
    if (currentQuiz) {
        currentQuestion = 0;
        answers = [];
        points = {};
        Object.keys(currentQuiz.results).forEach(result => {
            points[result] = 0;
        });
        loadQuestion();
        quizResults.classList.add('hidden');
        quizContainer.classList.remove('hidden');
    }
}

    // Save quiz result to history
    function saveQuizResult(quizTitle, result) {
        let history = JSON.parse(localStorage.getItem('quizHistory')) || [];

        // Add new result
        history.unshift({
            quiz: quizTitle,
            result: result,
            date: new Date().toISOString()
        });

        // Keep only the last 10 results
        if (history.length > 10) {
            history = history.slice(0, 10);
        }

        localStorage.setItem('quizHistory', JSON.stringify(history));
        loadQuizHistory();
    }

    // Load quiz history from localStorage
    function loadQuizHistory() {
        const history = JSON.parse(localStorage.getItem('quizHistory')) || [];

        if (history.length === 0) {
            historyEmpty.classList.remove('hidden');
            historyItems.classList.add('hidden');
            return;
        }

        historyEmpty.classList.add('hidden');
        historyItems.classList.remove('hidden');
        historyItems.innerHTML = '';

        history.forEach(item => {
            const quiz = Object.values(quizData).find(q => q.title === item.quiz);
            const result = quiz?.results[item.result];

            if (quiz && result) {
                const date = new Date(item.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

                const itemElement = document.createElement('div');
                itemElement.className = 'bg-bgLight dark:bg-gray-700 rounded-lg p-3 md:p-4 flex items-center';
                
                if (currentLanguage === 'ur') {
                    itemElement.innerHTML = `
                        <div class="flex-shrink-0 w-10 h-10 bg-brand/10 dark:bg-brand/20 rounded-full flex items-center justify-center text-brand dark:text-secondary mr-3 md:mr-4">
                            <span class="text-lg md:text-xl">${result.emoji}</span>
                        </div>
                        <div class="flex-grow urdu-text">
                            <h4 class="font-bold">${quiz.title_ur || quiz.title}</h4>
                            <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">${item.result} ‚Ä¢ ${dateStr}</p>
                        </div>
                        <button onclick="retakeQuiz('${Object.keys(quizData).find(key => quizData[key] === quiz)}')" class="text-brand dark:text-secondary hover:text-secondary dark:hover:text-accent transition">
                            <i class="fas fa-redo"></i>
                        </button>
                    `;
                } else {
                    itemElement.innerHTML = `
                        <div class="flex-shrink-0 w-10 h-10 bg-brand/10 dark:bg-brand/20 rounded-full flex items-center justify-center text-brand dark:text-secondary mr-3 md:mr-4">
                            <span class="text-lg md:text-xl">${result.emoji}</span>
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-bold">${item.quiz}</h4>
                            <p class="text-xs md:text-sm text-gray-600 dark:text-gray-300">${item.result} ‚Ä¢ ${dateStr}</p>
                        </div>
                        <button onclick="retakeQuiz('${Object.keys(quizData).find(key => quizData[key] === quiz)}')" class="text-brand dark:text-secondary hover:text-secondary dark:hover:text-accent transition">
                            <i class="fas fa-redo"></i>
                        </button>
                    `;
                }
                
                historyItems.appendChild(itemElement);
            }
        });
    }

    // Retake a quiz from history
    function retakeQuiz(quizId) {
        startQuiz(quizId);
    }

    // Clear quiz history
    function clearQuizHistory() {
        if (confirm('Are you sure you want to clear your quiz history?')) {
            localStorage.removeItem('quizHistory');
            loadQuizHistory();
            showSuccessToast('Quiz history cleared successfully!');
        }
    }

    // Show download modal
    function showDownloadModal() {
        // Calculate the result with highest points
        let maxPoints = 0;
        let resultKey = null;
        Object.keys(points).forEach(key => {
            if (points[key] > maxPoints) {
                maxPoints = points[key];
                resultKey = key;
            }
        });

        const result = currentQuiz.results[resultKey];
        const date = new Date();
        const profile = JSON.parse(localStorage.getItem('quizverse_profile'));

        // Set up download preview
        downloadTitle.textContent = currentQuiz.title;
        downloadSubtitle.textContent = "Your Personality Result";
        downloadPersonality.textContent = resultKey;
        downloadDescription.textContent = result.description;
        downloadEmoji.textContent = result.emoji;
        downloadDate.textContent = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        downloadFilename.value = `QuizVerse_${currentQuiz.title.replace(/\s+/g, '_')}_${profile?.name?.replace(/\s+/g, '_') || 'User'}_${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;

        openModal('download-modal');
    }

    // Download result as image
    function downloadResult(format) {
        // Get the result card element
        const resultCard = document.querySelector('.result-card');
        
        // Use html2canvas to capture the result card
        html2canvas(resultCard, {
            backgroundColor: null,
            scale: 2, // Higher quality
            logging: false,
            allowTaint: true,
            useCORS: true
        }).then(canvas => {
            // Create download link
            const link = document.createElement('a');
            link.download = `${downloadFilename.value}.${format}`;
            link.href = canvas.toDataURL(`image/${format}`, 1.0);
            link.click();
            
            // Close modal after download starts
            closeModal('download-modal');
            showSuccessToast('Download started successfully!');
        }).catch(err => {
            console.error('Error generating image:', err);
            showErrorToast('Failed to generate download. Please try again.');
        });
    }

    // Toggle dark/light theme
    function toggleTheme() {
        if (document.documentElement.classList.contains('dark')) {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
        } else {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
        }
    }

    // Toggle English/Urdu language
   function toggleLanguage(shouldSave = true) {
    if (currentLanguage === 'ur') {
        // Switch to English
        enLangElements.forEach(el => el.classList.remove('hidden'));
        urLangElements.forEach(el => el.classList.add('hidden'));
        currentLanguage = 'en';
    } else {
        // Switch to Urdu
        enLangElements.forEach(el => el.classList.add('hidden'));
        urLangElements.forEach(el => el.classList.remove('hidden'));
        currentLanguage = 'ur';
    }
    
    if (shouldSave) {
        localStorage.setItem('language', currentLanguage);
    }
    
    // Reload everything that needs language updates
    loadQuizCards();
    if (currentQuiz) {
        loadQuestion();
    }
    loadQuizHistory();
    updateHeaderButton();
    
    // Update load more button text
    updateLoadMoreButton(Object.keys(quizData).length);
}
    // Toggle mobile menu
    function toggleMobileMenu() {
        mobileMenu.classList.toggle('hidden');
    }

    // Show/hide back to top button
    function toggleBackToTop() {
        if (window.pageYOffset > 300) {
            backToTop.classList.remove('opacity-0', 'invisible');
            backToTop.classList.add('opacity-100', 'visible');
        } else {
            backToTop.classList.remove('opacity-100', 'visible');
            backToTop.classList.add('opacity-0', 'invisible');
        }
    }

    // Scroll to top
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    // Show success toast
    function showSuccessToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
        toast.innerHTML = `
            <i class="fas fa-check-circle mr-2"></i>
            ${message}
        `;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    // Show error toast
    function showErrorToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
        toast.innerHTML = `
            <i class="fas fa-exclamation-circle mr-2"></i>
            ${message}
        `;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    // Update header button based on profile status
    function updateHeaderButton() {
        const profile = localStorage.getItem('quizverse_profile');
        const signInButtons = document.querySelectorAll('[data-action="sign-in"]');

        signInButtons.forEach(btn => {
            if (profile) {
                const profileData = JSON.parse(profile);
                btn.innerHTML = `
                    <i class="fas fa-user-circle mr-2"></i>
                    ${profileData.name.split(' ')[0]}
                `;
                btn.classList.remove('bg-accent', 'text-textDark');
                btn.classList.add('bg-white/10', 'text-white');
            } else {
                if (currentLanguage === 'ur') {
                    btn.innerHTML = '<span class="urdu-text">ÿ≥ÿßÿ¶ŸÜ ÿßŸÜ</span>';
                } else {
                    btn.innerHTML = 'Sign In';
                }
                btn.classList.add('bg-accent', 'text-textDark');
                btn.classList.remove('bg-white/10', 'text-white');
            }
        });
    }

        // Enhanced Modal Functions
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) {
        console.error(`Modal with ID ${modalId} not found`);
        return;
      }

      // Close any other open modals first
      document.querySelectorAll('.modal-overlay:not(.hidden)').forEach(openModal => {
        if (openModal.id !== modalId) {
          openModal.classList.remove('active');
          setTimeout(() => {
            openModal.classList.add('hidden');
          }, 300);
        }
      });

      // Prepare to open new modal
      document.body.style.overflow = 'hidden';
      modal.classList.remove('hidden');

      // Small delay to allow CSS transition
      setTimeout(() => {
        modal.classList.add('active');
      }, 10);

      // Focus management
      const focusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (focusable) focusable.focus();

      // Keyboard event listener
      const handleKeyDown = (e) => {
        if (e.key === 'Escape') {
          closeModal(modalId);
        }

        // Trap focus within modal
        if (e.key === 'Tab') {
          const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey && document.activeElement === firstElement) {
            lastElement.focus();
            e.preventDefault();
          } else if (!e.shiftKey && document.activeElement === lastElement) {
            firstElement.focus();
            e.preventDefault();
          }
        }
      };

      modal._keydownHandler = handleKeyDown;
      document.addEventListener('keydown', handleKeyDown);
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;

      modal.classList.remove('active');
      setTimeout(() => {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
      }, 300);

      // Clean up event listeners
      if (modal._keydownHandler) {
        document.removeEventListener('keydown', modal._keydownHandler);
        delete modal._keydownHandler;
      }
    }

    // Profile form handling
    document.addEventListener('DOMContentLoaded', function () {
      // Check if profile exists
      const profile = localStorage.getItem('quizverse_profile');
      const profileSkipped = localStorage.getItem('quizverse_profile_skipped');

      // Show profile modal if no profile exists and not skipped
      if (!profile && !profileSkipped) {
        setTimeout(() => openModal('profile-modal'), 1000);
      }

      // Update header button based on profile
      updateHeaderButton();

      // Profile form submission
      const profileForm = document.getElementById('profile-form');
      if (profileForm) {
        profileForm.addEventListener('submit', function (e) {
          e.preventDefault();

          // Reset errors
          document.querySelectorAll('[id$="-error"]').forEach(el => el.classList.add('hidden'));
          document.getElementById('profile-success').classList.add('hidden');
          document.getElementById('profile-error').classList.add('hidden');

          // Validate form
          let isValid = true;
          const name = document.getElementById('profile-name').value.trim();
          const country = document.getElementById('profile-country').value;
          const age = document.getElementById('profile-age').value;
          const level = document.getElementById('profile-level').value;
          const gender = document.getElementById('profile-gender').value;
          const password = document.getElementById('profile-password').value;

          if (name.length < 2) {
            document.getElementById('name-error').classList.remove('hidden');
            isValid = false;
          }

          if (!country) {
            document.getElementById('country-error').classList.remove('hidden');
            isValid = false;
          }

          if (!age || age < 5 || age > 99) {
            document.getElementById('age-error').classList.remove('hidden');
            isValid = false;
          }

          if (!level) {
            document.getElementById('level-error').classList.remove('hidden');
            isValid = false;
          }

          if (!gender) {
            document.getElementById('gender-error').classList.remove('hidden');
            isValid = false;
          }

          if (password && password.length < 6) {
            document.getElementById('password-error').classList.remove('hidden');
            isValid = false;
          }

          if (isValid) {
            // Save profile (update existing or create new)
            const profileData = {
              name,
              country,
              age,
              level,
              gender,
              email: document.getElementById('profile-email').value.trim(),
              password: password || null,
              createdAt: localStorage.getItem('quizverse_profile') ?
                JSON.parse(localStorage.getItem('quizverse_profile')).createdAt :
                new Date().toISOString(),
              quizStats: localStorage.getItem('quizverse_profile') ?
                JSON.parse(localStorage.getItem('quizverse_profile')).quizStats || {
                  totalQuizzes: 0,
                  totalScore: 0,
                  totalQuestions: 0,
                  lastQuizDate: null
                } : {
                  totalQuizzes: 0,
                  totalScore: 0,
                  totalQuestions: 0,
                  lastQuizDate: null
                }
            };

            try {
              localStorage.setItem('quizverse_profile', JSON.stringify(profileData));
              localStorage.removeItem('quizverse_profile_skipped');

              // Show success
              document.getElementById('profile-success').classList.remove('hidden');

              // Update header button
              updateHeaderButton();

              // Close modal after delay
              setTimeout(() => {
                closeModal('profile-modal');
              }, 1500);
            } catch (e) {
              console.error('Error saving profile:', e);
              document.getElementById('profile-error').classList.remove('hidden');
            }
          }
        });
      }

      // Sign in/profile buttons in header
      const signInButtons = document.querySelectorAll('[data-action="sign-in"]');
      signInButtons.forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          if (localStorage.getItem('quizverse_profile')) {
            // Show profile view/edit modal
            openProfileView();
          } else {
            openModal('profile-modal');
          }
        });
      });

      // Close buttons in modals
      document.querySelectorAll('[onclick^="closeModal"]').forEach(btn => {
        const modalId = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          closeModal(modalId);
        });
      });
    });

    function skipProfile() {
      localStorage.setItem('quizverse_profile_skipped', 'true');
      closeModal('profile-modal');
    }

    function updateHeaderButton() {
      const profile = localStorage.getItem('quizverse_profile');
      const signInButtons = document.querySelectorAll('[data-action="sign-in"]');

      signInButtons.forEach(btn => {
        if (profile) {
          const profileData = JSON.parse(profile);
          btn.innerHTML = `
        <i class="fas fa-user-circle mr-2"></i>
        ${profileData.name.split(' ')[0]}
      `;
          btn.classList.remove('bg-accent', 'text-textDark');
          btn.classList.add('bg-white/10', 'text-white');
        } else {
          btn.innerHTML = 'Sign In';
          btn.classList.add('bg-accent', 'text-textDark');
          btn.classList.remove('bg-white/10', 'text-white');
        }
      });
    }

    function openProfileView() {
      const profile = JSON.parse(localStorage.getItem('quizverse_profile'));
      if (!profile) return;

      // Gender display text
      const genderDisplay = {
        'male': 'Male',
        'female': 'Female',
        'other': 'Other',
        'prefer-not': 'Prefer not to say'
      };

      // Create a comprehensive profile view modal
      const profileHTML = `
    <div class="space-y-6">
      <div class="flex flex-col items-center justify-center mb-6">
        <div class="w-24 h-24 rounded-full bg-brand/10 flex items-center justify-center text-4xl mb-4">
          <i class="fas fa-user text-brand"></i>
        </div>
        <h3 class="text-xl font-bold">${profile.name}</h3>
        <p class="text-gray-500">${profile.age} years ‚Ä¢ ${profile.country}</p>
      </div>
      
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="bg-bgLight dark:bg-gray-700 p-3 rounded-lg">
          <p class="text-sm text-gray-500">Level</p>
          <p class="font-medium capitalize">${profile.level.replace('-', ' ')}</p>
        </div>
        <div class="bg-bgLight dark:bg-gray-700 p-3 rounded-lg">
          <p class="text-sm text-gray-500">Gender</p>
          <p class="font-medium">${genderDisplay[profile.gender] || profile.gender}</p>
        </div>
        <div class="bg-bgLight dark:bg-gray-700 p-3 rounded-lg">
          <p class="text-sm text-gray-500">Member Since</p>
          <p class="font-medium">${new Date(profile.createdAt).toLocaleDateString()}</p>
        </div>
        <div class="bg-bgLight dark:bg-gray-700 p-3 rounded-lg">
          <p class="text-sm text-gray-500">Account</p>
          <p class="font-medium">${profile.email ? 'Verified' : 'Guest'}</p>
        </div>
      </div>
      
      ${profile.quizStats ? `
      <div class="bg-bgLight dark:bg-gray-700 p-4 rounded-lg mb-6">
        <div class="flex justify-between items-center mb-3">
          <h4 class="text-lg font-bold">Quiz Statistics</h4>
          <div class="flex space-x-2">
            <button onclick="downloadQuizStats()" class="text-xs bg-brand/10 hover:bg-brand/20 text-brand dark:text-brandLight px-2 py-1 rounded transition">
              <i class="fas fa-download mr-1"></i> Download
            </button>
            <button onclick="confirmResetStats()" class="text-xs bg-red-500/10 hover:bg-red-500/20 text-red-500 dark:text-red-400 px-2 py-1 rounded transition">
              <i class="fas fa-redo mr-1"></i> Reset
            </button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div class="bg-white dark:bg-gray-800 p-2 rounded">
            <p class="text-sm text-gray-500">Total Quizzes</p>
            <p class="font-bold text-lg">${profile.quizStats.totalQuizzes}</p>
          </div>
          <div class="bg-white dark:bg-gray-800 p-2 rounded">
            <p class="text-sm text-gray-500">Total Score</p>
            <p class="font-bold text-lg">${profile.quizStats.totalScore}</p>
          </div>
          <div class="bg-white dark:bg-gray-800 p-2 rounded">
            <p class="text-sm text-gray-500">Total Questions</p>
            <p class="font-bold text-lg">${profile.quizStats.totalQuestions}</p>
          </div>
          <div class="bg-white dark:bg-gray-800 p-2 rounded">
            <p class="text-sm text-gray-500">Accuracy</p>
            <p class="font-bold text-lg">${profile.quizStats.totalQuestions > 0 ? Math.round((profile.quizStats.totalScore / profile.quizStats.totalQuestions) * 100) : 0}%</p>
          </div>
        </div>
        ${profile.quizStats.lastQuizDate ? `
        <div class="mt-3 text-sm text-gray-500">
          Last quiz taken: ${new Date(profile.quizStats.lastQuizDate).toLocaleString()}
        </div>
        ` : ''}
      </div>
      ` : ''}
      
      <div class="flex flex-col space-y-3">
        <button onclick="openEditProfile()" class="w-full bg-brand hover:bg-secondary text-white dark:hover:bg-gray-600 px-4 py-2 rounded-lg transition">
          <i class="fas fa-edit mr-2"></i> Edit Profile
        </button>
        <button onclick="closeModal('profile-view-modal')" class="w-full text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 px-4 py-2 rounded-lg transition">
          Close
        </button>
      </div>
    </div>
  `;

      // Create or update profile view modal
      let profileViewModal = document.getElementById('profile-view-modal');
      if (!profileViewModal) {
        profileViewModal = document.createElement('div');
        profileViewModal.id = 'profile-view-modal';
        profileViewModal.className = 'modal-overlay hidden';
        profileViewModal.innerHTML = `
      <div class="modal-container">
        <div class="p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold text-brand dark:text-white">Your Profile</h3>
            <button onclick="closeModal('profile-view-modal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
              <i class="fas fa-times"></i>
            </button>
          </div>
          ${profileHTML}
        </div>
      </div>
    `;
        document.body.appendChild(profileViewModal);
      } else {
        const contentDiv = profileViewModal.querySelector('.modal-container > div');
        if (contentDiv) {
          contentDiv.innerHTML = `
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-2xl font-bold text-brand dark:text-white">Your Profile</h3>
          <button onclick="closeModal('profile-view-modal')" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
            <i class="fas fa-times"></i>
          </button>
        </div>
        ${profileHTML}
      `;
        }
      }

      openModal('profile-view-modal');
    }
    function openEditProfile() {
      const profile = JSON.parse(localStorage.getItem('quizverse_profile'));
      if (!profile) return;

      // Pre-fill the profile form with existing data
      document.getElementById('profile-name').value = profile.name;
      document.getElementById('profile-country').value = profile.country;
      document.getElementById('profile-age').value = profile.age;
      document.getElementById('profile-level').value = profile.level;
      document.getElementById('profile-gender').value = profile.gender;
      document.getElementById('profile-email').value = profile.email || '';
      document.getElementById('profile-password').value = '';

      // Close profile view modal and open edit modal
      closeModal('profile-view-modal');
      openModal('profile-modal');
    }

    // New functions for statistics handling
    function confirmResetStats() {
      const confirmModal = document.createElement('div');
      confirmModal.id = 'confirm-reset-modal';
      confirmModal.className = 'modal-overlay hidden';
      confirmModal.innerHTML = `
    <div class="modal-container max-w-md">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-red-500">Reset Statistics</h3>
          <button onclick="closeModal('confirm-reset-modal')" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <p class="mb-6">Are you sure you want to reset all your quiz statistics? This action cannot be undone.</p>
        <div class="flex justify-end space-x-3">
          <button onclick="closeModal('confirm-reset-modal')" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">
            Cancel
          </button>
          <button onclick="resetQuizStats()" class="px-4 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white">
            Reset Statistics
          </button>
        </div>
      </div>
    </div>
  `;

      document.body.appendChild(confirmModal);
      openModal('confirm-reset-modal');
    }

    function resetQuizStats() {
      const profile = JSON.parse(localStorage.getItem('quizverse_profile'));
      if (!profile) return;

      profile.quizStats = {
        totalQuizzes: 0,
        totalScore: 0,
        totalQuestions: 0,
        lastQuizDate: null
      };

      localStorage.setItem('quizverse_profile', JSON.stringify(profile));
      closeModal('confirm-reset-modal');

      // Show success message
      const successMsg = document.createElement('div');
      successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
      successMsg.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Statistics reset successfully!';
      document.body.appendChild(successMsg);

      setTimeout(() => {
        successMsg.remove();
        // Refresh profile view
        openProfileView();
      }, 2000);
    }

    function downloadQuizStats() {
      const profile = JSON.parse(localStorage.getItem('quizverse_profile'));
      if (!profile || !profile.quizStats) return;

      // Calculate accuracy
      const accuracy = profile.quizStats.totalQuestions > 0
        ? Math.round((profile.quizStats.totalScore / profile.quizStats.totalQuestions) * 100)
        : 0;

      // Create a canvas for the image
      const canvas = document.createElement('canvas');
      canvas.width = 800;
      canvas.height = 600;
      const ctx = canvas.getContext('2d');

      // Background gradient
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#4f46e5');
      gradient.addColorStop(1, '#06b6d4');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Add decorative elements
      ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.arc(
          Math.random() * canvas.width,
          Math.random() * canvas.height,
          Math.random() * 50 + 20,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }

      // Add logo or title
      ctx.fillStyle = 'white';
      ctx.font = 'bold 32px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('QuizVerse Statistics', canvas.width / 2, 60);

      // Add user info
      ctx.font = '20px Arial';
      ctx.fillText(`${profile.name}'s Quiz Performance`, canvas.width / 2, 100);

      // Add stats boxes
      const stats = [
        { label: 'Total Quizzes', value: profile.quizStats.totalQuizzes },
        { label: 'Total Score', value: profile.quizStats.totalScore },
        { label: 'Total Questions', value: profile.quizStats.totalQuestions },
        { label: 'Accuracy', value: `${accuracy}%` }
      ];

      ctx.font = 'bold 16px Arial';
      ctx.textAlign = 'left';

      stats.forEach((stat, index) => {
        const x = index % 2 === 0 ? 100 : 450;
        const y = 180 + Math.floor(index / 2) * 120;

        // Stat box
        ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
        ctx.roundRect(x, y, 250, 80, 10);
        ctx.fill();

        // Stat text
        ctx.fillStyle = 'white';
        ctx.fillText(stat.label, x + 20, y + 30);
        ctx.font = 'bold 28px Arial';
        ctx.fillText(stat.value.toString(), x + 20, y + 65);
        ctx.font = 'bold 16px Arial';
      });

      // Add footer
      ctx.font = '14px Arial';
      ctx.textAlign = 'center';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
      ctx.fillText(`Generated on ${new Date().toLocaleDateString()}`, canvas.width / 2, 550);
      ctx.fillText('quizverse.example.com', canvas.width / 2, 580);

      // Convert to image and download
      canvas.toBlob(blob => {
        const link = document.createElement('a');
        link.download = `quizverse-stats-${profile.name.replace(' ', '-')}.png`;
        link.href = URL.createObjectURL(blob);
        link.click();
        URL.revokeObjectURL(link.href);
      }, 'image/png', 1);
    }

function saveProfile(e) {
    e.preventDefault();
    
    // Reset errors
    document.querySelectorAll('[id$="-error"]').forEach(el => el.classList.add('hidden'));
    document.getElementById('profile-success').classList.add('hidden');
    document.getElementById('profile-error').classList.add('hidden');
    
    // Validate form
    let isValid = true;
    const name = document.getElementById('profile-name').value.trim();
    const country = document.getElementById('profile-country').value;
    const age = document.getElementById('profile-age').value;
    const level = document.getElementById('profile-level').value;
    const gender = document.getElementById('profile-gender').value;
    const password = document.getElementById('profile-password').value;
    
    if (name.length < 2) {
        document.getElementById('name-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!country) {
        document.getElementById('country-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!age || age < 5 || age > 99) {
        document.getElementById('age-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!level) {
        document.getElementById('level-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (!gender) {
        document.getElementById('gender-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (password && password.length < 6) {
        document.getElementById('password-error').classList.remove('hidden');
        isValid = false;
    }
    
    if (isValid) {
        try {
            const profileData = {
                name,
                country,
                age,
                level,
                gender,
                email: document.getElementById('profile-email').value.trim(),
                password: password || null,
                createdAt: new Date().toISOString(),
                quizStats: {
                    totalQuizzes: 0,
                    totalScore: 0,
                    totalQuestions: 0,
                    lastQuizDate: null
                }
            };
            
            localStorage.setItem('quizverse_profile', JSON.stringify(profileData));
            localStorage.removeItem('quizverse_profile_skipped');
            
            document.getElementById('profile-success').classList.remove('hidden');
            updateHeaderButton();
            
            setTimeout(() => {
                closeModal('profile-modal');
            }, 1500);
        } catch (e) {
            console.error('Error saving profile:', e);
            document.getElementById('profile-error').classList.remove('hidden');
        }
    }
}
</script>
    <script src="/js/analytics.js"></script>

</body>
</html>